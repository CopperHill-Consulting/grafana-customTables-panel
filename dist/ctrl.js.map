{"version":3,"sources":["../src/ctrl.js"],"names":["RGX_SIMPLE_NUMBER","DEFAULT_PSEUDO_CSS","CONTENT_RULE_TYPES","id","text","CONTENT_RULE_CLASS_LEVELS","CONTENT_RULE_MAX_VALUE_OPS","CONTENT_RULE_MIN_VALUE_OPS","CONTENT_RULE_EXACT_NUM_OPS","DEFAULT_PANEL_SETTINGS","pseudoCSS","columnDefs","isFullWidth","allowOrdering","allowSearching","allowLengthChange","pageLengths","initialPageLength","parseRegExp","strPattern","parts","exec","RegExp","_","escapeRegExp","pseudoCssToJSON","strLess","openCount","closeCount","replace","match","ruleName","styleName","styleValue","JSON","stringify","trim","parse","e","Error","setContent","jElem","ctrl","data","panel","varsByName","getVarsByName","height","tableOpts","cls","style","width","table","JS","dom","jTable","jQuery","appendTo","html","colDefs","colDefRgxs","map","colDef","filter","columnTexts","colDefIndexByCol","title","reduce","carry","colDefRgx","colDefIndex","test","colDefContentRuleFilters","contentRules","rule","type","options","rows","columns","colIndex","result","display","isVisible","classNames","className","orderable","isOrderable","searchable","isSearchable","visible","scrollY","scrollX","scrollCollapse","ordering","searching","lengthChange","lengthMenu","getPageLengthOptions","arr","opt","concat","value","Infinity","pageLength","order","rowCallback","tr","rowData","tdIndex","cellsByColName","reduceRight","val","i","extend","cell","rules","find","ruleIndex","isMatch","colDefContentRuleFilter","gcvOptions","minValue","minIsNum","maxValue","maxIsNum","minValueOp","maxValueOp","negateCriteria","jTD","eq","getCellValue","classLevel","addClass","displayIsHTML","escape","url","openNewWindow","dataTable","DataTable","css","fixDataTableSize","each","elem","appendChild","valToMod","isForLink","matches","matchesKey","name","isRaw","isEscape","isParam","paramName","Set","has","length","join","v","encodeURIComponent","undefined","jWrap","fullHeight","wrapHeight","jScrollBody","scrollHeight","nonScrollHeight","renderNow","error","isValid","jContent","elemContent","pageLengthOptions","err","msg","message","elemMsg","alignItems","textAlign","$","margin","append","parseData","headers","col","cloneDeep","column","row","slice","cellValue","names","level","displayHTML","DataTablePanelCtrl","$scope","$injector","$rootScope","defaultsDeep","events","on","onInitEditMode","bind","onDataReceived","onDataError","onInitPanelActions","path","addEditorTab","actions","push","click","dataList","isReal","EXTRA_COLS","range","y","x","Math","random","obj","key","newValue","eval","columnDef","splice","indexOf","contentRule","split","parseInt","href","toCSV","download","formatDate","Date","templateSrv","variables","variable","varValues","toArray","current","isAll","includeAll","emit","scope","attrs","call","debounce","MetricsPanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport * as JS from './external/YourJS.min';\nimport './external/toCSV';\nimport './external/datatables/js/jquery.dataTables.min';\nimport './external/datatables/js/dataTables.fixedHeader.min';\nimport './external/datatables/css/jquery.dataTables.min.css!';\nimport './external/datatables/css/fixedHeader.dataTables.min.css!';\nimport './external/datatables-grafana-fix.css!';\n\nconst RGX_SIMPLE_NUMBER = /^\\d+(\\.\\d+)?$/;\n\nconst DEFAULT_PSEUDO_CSS = `\n.theme-dark & {\n  color: white;\n}\ntable.dataTable tbody tr {\n  &:hover td {\n    background-image: linear-gradient(0deg, rgba(128,128,128,0.1), rgba(128,128,128,0.1));\n  }\n  &, &.even, &.odd {\n    background-color: transparent;\n    >.sorting_1, >.sorting_2, >.sorting_3 {\n      background-color: transparent;\n    }\n    td {\n      border-color: transparent;\n    }\n  }\n  &.odd {\n    background-color: rgba(128,128,128,0.3);\n  }\n  &.even {\n    background-color: rgba(128,128,128,0.15);\n  }\n}\n`;\n\nconst CONTENT_RULE_TYPES = [\n  { id: 'FILTER', text: 'Filter by exact value or RegExp' },\n  { id: 'RANGE', text: \"Match a range of values\" },\n  { id: 'NULL', text: \"Is NULL\" }\n];\n\nconst CONTENT_RULE_CLASS_LEVELS = [\n  { id: 'CELL', text: \"Only the cell\" },\n  { id: 'ROW', text: 'Entire row' }\n];\n\nconst CONTENT_RULE_MAX_VALUE_OPS = [\n  { id: '', text: '' },\n  { id: '>=', text: '\\u2265 (greater than or equal to)' },\n  { id: '>', text: '> (greater than)' }\n];\n\nconst CONTENT_RULE_MIN_VALUE_OPS = [\n  { id: '', text: '' },\n  { id: '<', text: '< (less than)' },\n  { id: '<=', text: '\\u2264 (less than or equal to)' }\n];\n\nconst CONTENT_RULE_EXACT_NUM_OPS = [\n  { id: '==', text: '= (equals)' },\n  { id: '!=', text: \"\\u2260 (doesn't)\" }\n];\n\nconst DEFAULT_PANEL_SETTINGS = {\n  pseudoCSS: DEFAULT_PSEUDO_CSS,\n  columnDefs: [],\n  isFullWidth: true,\n  allowOrdering: true,\n  allowSearching: true,\n  allowLengthChange: true,\n  pageLengths: '10,15,20,25,50,100',\n  initialPageLength: 25\n};\n\nfunction parseRegExp(strPattern) {\n  let parts = /^\\/(.+)\\/(\\w*)$/.exec(strPattern);\n  return parts ? new RegExp(parts[1], parts[2]) : new RegExp('^' + _.escapeRegExp(strPattern) + '$', 'i');\n}\n\nfunction pseudoCssToJSON(strLess) {\n  var openCount = 0;\n  var closeCount = 0;\n\n  strLess = strLess\n    .replace(/\\/\\*[^]*?\\*\\//g, '')\n    .replace(\n      /([^\\{\\};]+)\\{|([^:\\{\\}]+):([^;]+);|\\}/g,\n      function (match, ruleName, styleName, styleValue) {\n        if (ruleName) {\n          openCount++;\n          return JSON.stringify(ruleName.trim()) + \":{\";\n        }\n        if (styleName) {\n          return JSON.stringify(styleName.trim()) + \":\" + JSON.stringify(styleValue.trim()) + \",\";\n        }\n        closeCount++;\n        return \"},\";\n      }\n    )\n    .replace(/,\\s*(\\}|$)/g, '$1');\n\n  try {\n    return JSON.stringify(JSON.parse(\"{\" + strLess + \"}\"), null, 2);\n  }\n  catch (e) {\n    throw new Error(\n      openCount !== closeCount\n        ? \"Pseudo-CSS contains too many \" + (openCount > closeCount ? \"open\" : \"clos\") + \"ing braces.\"\n        : \"Pseudo-CSS couldn't be parsed correctly.\"\n    );\n  }\n}\n\nfunction setContent(jElem, ctrl) {\n  let data = ctrl.data;\n  let panel = ctrl.panel;\n  let varsByName = ctrl.getVarsByName();\n  let height = jElem.height();\n\n  let tableOpts = { _: 'table', cls: 'display', style: {} };\n  if (panel.isFullWidth) {\n    tableOpts.style.width = '100%';\n  }\n\n  let table = JS.dom(tableOpts);\n  let jTable = jQuery(table).appendTo(jElem.html(''));\n  let colDefs = panel.columnDefs;\n  let colDefRgxs = colDefs.map(colDef => parseRegExp(colDef.filter));\n  let columnTexts = data.columnTexts;\n  let colDefIndexByCol = columnTexts.map(\n    title => colDefRgxs.reduce(\n      (carry, colDefRgx, colDefIndex) => (carry < 0 && colDefRgx.test(title)) ? colDefIndex : carry,\n      -1\n    )\n  );\n  let colDefContentRuleFilters = colDefs.map(\n    colDef => colDef.contentRules.map(\n      rule => rule.type === 'FILTER' ? parseRegExp(rule.filter) : null\n    )\n  );\n  let options = {\n    data: data.rows,\n    columns: columnTexts.map((title, colIndex) => {\n      let result = { title };\n\n      let colDefIndex = colDefIndexByCol[colIndex];\n      let colDef = colDefs[colDefIndex];\n      if (colDef) {\n        let filter = colDefRgxs[colDefIndex];\n        if (filter.test(title)) {\n          if (colDef.display) {\n            result.title = title.replace(filter, colDef.display);\n          }\n          if (colDef.isVisible) {\n            if (colDef.width) {\n              result.width = colDef.width;\n            }\n            if (colDef.classNames) {\n              result.className = colDef.classNames;\n            }\n            result.orderable = colDef.isOrderable;\n            result.searchable = colDef.isSearchable;\n          }\n          else {\n            result.visible = colDef.isVisible;\n          }\n        }\n      }\n\n      return result;\n    }),\n    scrollY: height,\n    scrollX: true,\n    scrollCollapse: true,\n    ordering: panel.allowOrdering,\n    searching: panel.allowSearching,\n    lengthChange: panel.allowLengthChange,\n    lengthMenu: ctrl.getPageLengthOptions().reduce(\n      (arr, opt) => [\n        arr[0].concat([opt.value === Infinity ? -1 : opt.value]),\n        arr[1].concat([opt.value === Infinity ? 'All' : opt.value])\n      ],\n      [[],[]]\n    ),\n    pageLength: panel.initialPageLength,\n    order: [],\n    rowCallback: function(tr, rowData) {\n      let tdIndex = -1;\n      let cellsByColName = rowData.reduceRight(\n        (carry, val, i) => _.extend(carry, { [columnTexts[i]]: val }),\n        {}\n      );\n      rowData.map((cell, colIndex) => {\n        let colDefIndex = colDefIndexByCol[colIndex];\n        let colDef = colDefs[colDefIndex];\n\n        if (!colDef || colDef.isVisible) {\n          tdIndex++;\n        }\n\n        if (colDef) {\n          if (colDef.isVisible) {\n            let rules = colDef.contentRules;\n            // Use Array#find() solely to match the first applicable rule...\n            rules.find((rule, ruleIndex) => {\n              let isMatch = true;\n              let type = rule.type;\n              let colDefContentRuleFilter = colDefContentRuleFilters[colDefIndex][ruleIndex];\n              let gcvOptions = { cell, cellsByColName, rule, colDefContentRuleFilter, ctrl, varsByName };\n              if (type === 'FILTER') {\n                isMatch = colDefContentRuleFilter.test(cell);\n              }\n              else if (type === 'RANGE') {\n                let minValue = rule.minValue;\n                let minIsNum = RGX_SIMPLE_NUMBER.test(minValue);\n                let maxValue = rule.maxValue;\n                let maxIsNum = RGX_SIMPLE_NUMBER.test(maxValue);\n                if (minIsNum) {\n                  minValue = +minValue;\n                }\n                if (maxIsNum) {\n                  maxValue = +maxValue;\n                }\n\n                if (minIsNum || maxIsNum) {\n                  cell = +cell;\n                }\n\n                let minValueOp = rule.minValueOp;\n                if (minValueOp) {\n                  isMatch = isMatch && (minValueOp === '<=' ? minValue <= cell : (minValue < cell));\n                }\n                let maxValueOp = rule.maxValueOp;\n                if (maxValueOp) {\n                  isMatch = isMatch && (maxValueOp === '>=' ? maxValue >= cell : (maxValue > cell));\n                }\n              }\n              else {\n                isMatch = cell == null;\n              }\n\n              isMatch = isMatch !== rule.negateCriteria;\n\n              // If this is a match apply the class(es)\n              if (isMatch) {\n                let jTD = jQuery('>td', tr).eq(tdIndex);\n                if (rule.classNames) {\n                  let classNames = getCellValue(rule.classNames, false, gcvOptions);\n                  if (rule.classLevel === 'ROW') {\n                    jQuery(tr).addClass(classNames);\n                  }\n                  else {\n                    jTD.addClass(classNames);\n                  }\n                }\n\n                // Set the display\n                let display = getCellValue(rule.display, false, gcvOptions);\n                if (rule.displayIsHTML) {\n                  display = _.escape(display);\n                }\n                if (rule.url) {\n                  let url = _.escape(getCellValue(rule.url, true, gcvOptions));\n                  display = `<a href=\"${url}\" target=\"${rule.openNewWindow ? '_blank' : '_self'}\">${display}</a>`;\n                }\n                jTD.html(display);\n              }\n\n              return isMatch;\n            }, false);\n          }\n        }\n      });\n    }\n  };\n  let dataTable = jTable.DataTable(options);\n\n  jElem.find('.dataTables_scrollHeadInner').css('margin', '0 auto');\n  fixDataTableSize(jElem.find('.dataTables_wrapper'), height);\n\n  jElem.each((i, elem) => {\n    elem.className = elem.className.replace(/\\b_\\d+\\b/g, ' ').replace(/\\s+/g, ' ').trim();\n    elem.appendChild(JS.css(JSON.parse(pseudoCssToJSON(panel.pseudoCSS)), elem));\n  });\n}\n\nfunction getCellValue(valToMod, isForLink, { display, cellsByColName, rule, colDefContentRuleFilter, ctrl, varsByName }) {\n  let matches = rule.type === 'FILTER'\n    ? display != null\n      ? colDefContentRuleFilter.exec(display + '')\n      : { '0': 'null' }\n    : { '0': display };\n  _.extend(matches, { value: display, cell: display });\n  return valToMod.replace(\n    /\\${(?:(value|cell|0|[1-9]\\d*)|(col|var):((?:[^\\}:\\\\]*|\\\\.)+))(?::(?:(raw)|(escape)|(param)(?::((?:[^\\}:\\\\]*|\\\\.)+))?))?}/g,\n    function (match, matchesKey, type, name, isRaw, isEscape, isParam, paramName) {\n      isRaw = isRaw || !(isForLink || isEscape);\n      name = name && name.replace(/\\\\(.)/g, '$1');\n      let result = [...new Set(\n        matchesKey\n          ? _.has(matches, matchesKey) ? [matches[matchesKey]] : []\n          : type === 'col'\n            ? _.has(cellsByColName, name) ? [cellsByColName[name]] : []\n            : _.has(varsByName, name) ? varsByName[name] : []\n      )];\n      return result.length < 1\n        ? match\n        : isRaw\n          ? result.join(',')\n          : isParam\n            ? result.map(v => encodeURIComponent(paramName == undefined ? name : paramName) + '=' + encodeURIComponent(v)).join('&')\n            : encodeURIComponent(result.join(','));\n    }\n  )\n}\n\nfunction fixDataTableSize(jWrap, fullHeight) {\n  let wrapHeight = jWrap.height();\n  let jScrollBody = jWrap.find('.dataTables_scrollBody');\n  let scrollHeight = jScrollBody.height();\n  let nonScrollHeight = wrapHeight - scrollHeight;\n  jScrollBody.css('max-height', fullHeight - nonScrollHeight);\n}\n\nfunction renderNow(e, jElem) {\n  let error,\n      isValid = false,\n      ctrl = this,\n      data = ctrl.data,\n      jContent = jElem.find('.panel-content').css('position', 'relative').html(''),\n      elemContent = jContent[0];\n\n  ctrl.pageLengthOptions = ctrl.getPageLengthOptions();\n  \n  if (data && data.rows.length) {\n    if (data.type === 'table') {\n      try {\n        setContent(jContent, ctrl);\n        isValid = true;\n      }\n      catch (err) {\n        error = err;\n      }\n    }\n  }\n  if (!isValid) {\n    let msg = 'No data' + (error ? ':  \\r\\n' + error.message : '.');\n    let elemMsg = JS.dom({ _: 'div', style: { display: 'flex', alignItems: 'center', textAlign: 'center', height: '100%' }, $: [\n      { _: 'div', cls: 'alert alert-error', style: { margin: '0px auto' }, text: msg }\n    ]});\n    jContent.html('').append(elemMsg);\n    if (error) {\n      throw error;\n    }\n  }\n}\n\nfunction parseData(columns, rows, ctrl) {\n  // let result = {\n  //   columns,\n  //   rows,\n  //   columnTexts: columns.map(col => 'string' === typeof col ? col : col.text)\n  // };\n\n  let varsByName = ctrl.getVarsByName();\n  let headers = columns.map(col => col.text);\n  let colDefs = ctrl.panel.columnDefs;\n  let colDefRgxs = colDefs.map(colDef => parseRegExp(colDef.filter));\n  let colDefContentRuleFilters = colDefs.map(\n    colDef => colDef.contentRules.map(\n      rule => rule.type === 'FILTER' ? parseRegExp(rule.filter) : null\n    )\n  );\n\n  columns = _.cloneDeep(columns).map(column => {\n    column = _.extend(\n      'string' === typeof column ? { text: column } : column,\n      { visible: true }\n    );\n    colDefRgxs.find((colDefRgx, colDefIndex) => {\n      if (colDefRgx.test(column.text)) {\n        let colDef = colDefs[colDefIndex];\n        column = _.extend({}, column, {\n          html: colDef.displayIsHTML ? column.text : _.escape(column.text),\n          colDef: colDef,\n          visible: colDef.isVisible,\n          colDefRgx,\n          colDefContentRuleFilters: colDefContentRuleFilters[colDefIndex]\n        });\n        return true;\n      }\n    });\n    return column;\n  });\n\n  rows = rows.map(row => {\n    return row.slice().map((cellValue, colIndex) => {\n      let column = columns[colIndex];\n      let colDef = column.colDef && column.colDef;\n\n      let cell = {\n        html: cellValue,\n        visible: column.visible\n      };\n\n      if (colDef) {\n        let rules = colDef.contentRules;\n        let cellsByColName = row.reduceRight(\n          (carry, val, i) => _.extend(carry, { [headers[i]]: val }),\n          {}\n        );\n\n        // Use Array#find() solely to match the first applicable rule...\n        rules.find((rule, ruleIndex) => {\n          let isMatch = true;\n          let type = rule.type;\n          let colDefContentRuleFilter = column.colDefContentRuleFilters[ruleIndex];\n          let gcvOptions = {\n            cell: cell.html,\n            cellsByColName,\n            rule,\n            colDefContentRuleFilter,\n            ctrl,\n            varsByName\n          };\n          if (type === 'FILTER') {\n            isMatch = colDefContentRuleFilter.test(cell.html);\n          }\n          else if (type === 'RANGE') {\n            let minValue = rule.minValue;\n            let minIsNum = RGX_SIMPLE_NUMBER.test(minValue);\n            let maxValue = rule.maxValue;\n            let maxIsNum = RGX_SIMPLE_NUMBER.test(maxValue);\n            if (minIsNum) {\n              minValue = +minValue;\n            }\n            if (maxIsNum) {\n              maxValue = +maxValue;\n            }\n\n            if (minIsNum || maxIsNum) {\n              cellValue = +cellValue;\n            }\n\n            let minValueOp = rule.minValueOp;\n            if (minValueOp) {\n              isMatch = isMatch && (minValueOp === '<=' ? minValue <= cellValue : (minValue < cellValue));\n            }\n            let maxValueOp = rule.maxValueOp;\n            if (maxValueOp) {\n              isMatch = isMatch && (maxValueOp === '>=' ? maxValue >= cellValue : (maxValue > cellValue));\n            }\n          }\n          else {\n            isMatch = cell.html == null;\n          }\n\n          isMatch = isMatch !== rule.negateCriteria;\n\n          // If this is a match apply the class(es)\n          if (isMatch) {\n            if (rule.classNames) {\n              cell.cls = {\n                names: getCellValue(rule.classNames, false, gcvOptions),\n                level: rule.classLevel\n              };\n            }\n\n            // Set the display\n            let displayHTML = getCellValue(rule.display, false, gcvOptions);\n            if (!rule.displayIsHTML) {\n              displayHTML = _.escape(displayHTML);\n            }\n            if (rule.url) {\n              let url = _.escape(getCellValue(rule.url, true, gcvOptions));\n              displayHTML = `<a href=\"${url}\" target=\"${rule.openNewWindow ? '_blank' : '_self'}\">${displayHTML}</a>`;\n            }\n            cell.html = displayHTML;\n          }\n\n          return isMatch;\n        });\n      }\n\n      return cell;\n    });\n  });\n\n  return { columns, rows, headers };\n}\n\nexport class DataTablePanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n\n    this.$rootScope = $rootScope;\n    this.data = null;\n\n    _.defaultsDeep(this.panel, DEFAULT_PANEL_SETTINGS);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n  }\n\n  onInitEditMode() {\n    let path = 'public/plugins/copperhill-datatables-panel/partials/';\n    this.addEditorTab('Options', `${path}editor.html`, 2);\n    this.addEditorTab('Column Definitions', `${path}column-defs.html`, 3);\n    this.addEditorTab('Styles', `${path}styles.html`, 4);\n  }\n\n  onInitPanelActions(actions) {\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCSV()' });\n  }\n\n  onDataError() {\n    this.renderNow();\n  }\n\n  onDataReceived(dataList) {\n    if (dataList && dataList.length) {\n      let data = dataList[0];\n      this.data = _.extend(\n        parseData(data.columns, data.rows, this),\n        { isReal: true, type: data.type }\n      );\n    }\n    else {\n      let EXTRA_COLS = 2;\n      this.data = _.extend(\n        parseData(\n          [{ text: \"X\" }, { text: \"X * X\" }, { text: \"X + X\" }].concat(_.range(EXTRA_COLS).map(y => ({ text: `${y} / Math.random()`}))),\n          _.range(150).map(x => [x, x * x, x + x].concat(_.range(EXTRA_COLS).map(y => y / Math.random()))),\n          this\n        ),\n        { isReal: false, type: 'table' }\n      );\n    }\n\n    this.renderNow();\n  }\n\n  onChangeCallback(obj, key) {\n    return newValue => {\n      obj[key] = newValue;\n      this.renderNow();\n    };\n  }\n\n  getConstByName(name) {\n    if (/^[A-Z_][A-Z_0-9]*$/.test(name)) {\n     return eval(name);\n    }\n  }\n\n  addColumnDef() {\n    this.panel.columnDefs.push({\n      filter: '/[^]*/',\n      display: '',\n      width: '',\n      classNames: '',\n      isVisible: true,\n      isOrderable: true,\n      isSearchable: true,\n      contentRules: []\n    });\n  }\n\n  removeColumnDef(columnDef) {\n    let columnDefs = this.panel.columnDefs;\n    columnDefs.splice(columnDefs.indexOf(columnDef), 1);\n  }\n\n  addColumnContentRule(columnDef) {\n    columnDef.contentRules.push({\n      type: CONTENT_RULE_TYPES[0].id,\n      classNames: '',\n      classLevel: CONTENT_RULE_CLASS_LEVELS[0].id,\n      filter: '',\n      negateCriteria: false,\n      display: '${value}',\n      displayIsHTML: false,\n      minValue: null,\n      maxValue: null,\n      minValueOp: null,\n      maxValueOp: null,\n      url: '',\n      openNewWindow: true\n    });\n  }\n\n  removeColumnContentRule(contentRule, columnDef) {\n    let contentRules = columnDef.contentRules;\n    contentRules.splice(contentRules.indexOf(contentRule), 1);\n  }\n\n  getPageLengthOptions() {\n    return this.panel.pageLengths\n        .replace(/\\s+/g, '')\n        .split(',')\n        .reduce(\n          (arr, x) => {\n            if (+x === parseInt(x, 10) && +x >= -1) {\n              x = x == -1 ? Infinity : +x;\n              arr.push({ value: x, text: x === Infinity ? 'All' : x });\n            }\n            return arr;\n          },\n          []\n        );\n  }\n\n  exportCSV() {\n    JS.dom({\n      _: 'a',\n      href: 'data:text/csv;charset=utf-8,' + encodeURIComponent(\n        toCSV(this.data.rows, { headers: this.data.columnTexts })\n      ),\n      download: this.panel.title + JS.formatDate(new Date, \" (YYYY-MM-DD 'at' H:mm:ss).'csv'\")\n    }).click();\n  }\n\n  getVarsByName() {\n    return this.templateSrv.variables.reduce(\n      (carry, variable) => {\n        // At times current.value is a string and at times it is an array.\n        let varValues = JS.toArray(variable.current.value);\n        let isAll = variable.includeAll && varValues.length === 1 && varValues[0] === '$__all';\n        carry[variable.name] = isAll ? [variable.current.text] : varValues;\n        return carry;\n      },\n      {}\n    );\n  }\n\n  renderNow(e, elem) {\n    this.events.emit('renderNow');\n  }\n\n  renderAfterOneSec() {\n    this.events.emit('renderAfterOneSec');\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.events.on('renderNow', e => renderNow.call(this, e, elem));\n    this.events.on('render', _.debounce(e => renderNow.call(this, e, elem), 250));\n    this.events.on('renderAfterOneSec', _.debounce(e => renderNow.call(this, e, elem), 1000));\n  }\n}\n\nDataTablePanelCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}