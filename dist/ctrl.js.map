{"version":3,"sources":["../src/ctrl.js"],"names":["DEFAULT_PSEUDO_CSS","CONTENT_RULE_TYPES","id","text","CONTENT_RULE_CLASS_LEVELS","CONTENT_RULE_MAX_VALUE_OPS","CONTENT_RULE_MIN_VALUE_OPS","CONTENT_RULE_EXACT_NUM_OPS","DEFAULT_PANEL_SETTINGS","pseudoCSS","columnDefs","isFullWidth","allowOrdering","allowSearching","allowLengthChange","pageLengths","initialPageLength","DataTablePanelCtrl","$scope","$injector","$rootScope","_","defaultsDeep","panel","events","on","onInitEditMode","bind","onDataReceived","onDataError","onInitPanelActions","onPanelSizeChanged","fixDataTableSize","path","addEditorTab","actions","push","click","draw","dataList","length","forEach","data","isReal","EXTRA_COLS","columns","concat","range","map","y","rows","x","Math","random","type","name","test","eval","filter","display","width","classNames","isVisible","isOrderable","isSearchable","contentRules","columnDef","splice","indexOf","classLevel","negateCriteria","displayIsHTML","minValue","maxValue","minValueOp","maxValueOp","url","openNewWindow","contentRule","replace","split","reduce","arr","parseInt","Infinity","value","div","JS","dom","parseDataList","href","encodeURIComponent","toCSV","row","carry","cell","visible","innerHTML","html","textContent","headers","header","download","title","formatDate","Date","templateSrv","variables","variable","varValues","toArray","current","isAll","includeAll","ctrl","jElem","panelElement","height","tableOpts","cls","style","table","jTable","jQuery","appendTo","dataTableOpts","column","colIndex","result","colDef","className","orderable","searchable","scrollY","scrollX","scrollCollapse","ordering","searching","lengthChange","lengthMenu","getPageLengthOptions","opt","pageLength","order","rowCallback","tr","rowData","tdIndex","jTD","eq","level","addClass","names","dataTable","DataTable","find","css","each","i","elem","trim","appendChild","JSON","parse","pseudoCssToJSON","varsByName","getVarsByName","col","colDefs","colDefRgxs","parseRegExp","colDefContentRuleFilters","rule","cloneDeep","extend","colDefRgx","colDefIndex","escape","has","slice","cellValue","rules","cellsByColName","reduceRight","val","ruleIndex","isMatch","colDefContentRuleFilter","gcvOptions","minIsNum","RGX_SIMPLE_NUMBER","maxIsNum","getCellValue","displayHTML","refId","fullHeight","jWrap","wrapHeight","jScrollBody","scrollHeight","nonScrollHeight","error","isValid","element","jContent","elemContent","pageLengthOptions","setContent","err","msg","message","elemMsg","alignItems","textAlign","$","margin","append","scope","attrs","throttleDraw","debounce","MetricsPanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport * as JS from './external/YourJS.min';\nimport './external/helper-functions';\nimport './external/datatables/js/jquery.dataTables.min';\nimport './external/datatables/js/dataTables.fixedHeader.min';\nimport './external/datatables/css/jquery.dataTables.min.css!';\nimport './external/datatables/css/fixedHeader.dataTables.min.css!';\n\nconst DEFAULT_PSEUDO_CSS = `\n.theme-dark & {\n  color: white;\n}\ntable.dataTable tbody tr {\n  &:hover td {\n    background-image: linear-gradient(0deg, rgba(128,128,128,0.1), rgba(128,128,128,0.1));\n  }\n  &, &.even, &.odd {\n    background-color: transparent;\n    >.sorting_1, >.sorting_2, >.sorting_3 {\n      background-color: transparent;\n    }\n    td {\n      border-color: transparent;\n    }\n  }\n  &.odd {\n    background-color: rgba(128,128,128,0.3);\n  }\n  &.even {\n    background-color: rgba(128,128,128,0.15);\n  }\n}\n`;\n\nconst CONTENT_RULE_TYPES = [\n  { id: 'FILTER', text: 'Filter by exact value or RegExp' },\n  { id: 'RANGE', text: \"Match a range of values\" },\n  { id: 'NULL', text: \"Is NULL\" }\n];\n\nconst CONTENT_RULE_CLASS_LEVELS = [\n  { id: 'CELL', text: \"Only the cell\" },\n  { id: 'ROW', text: 'Entire row' }\n];\n\nconst CONTENT_RULE_MAX_VALUE_OPS = [\n  { id: '', text: '' },\n  { id: '>=', text: '\\u2265 (greater than or equal to)' },\n  { id: '>', text: '> (greater than)' }\n];\n\nconst CONTENT_RULE_MIN_VALUE_OPS = [\n  { id: '', text: '' },\n  { id: '<', text: '< (less than)' },\n  { id: '<=', text: '\\u2264 (less than or equal to)' }\n];\n\nconst CONTENT_RULE_EXACT_NUM_OPS = [\n  { id: '==', text: '= (equals)' },\n  { id: '!=', text: \"\\u2260 (doesn't)\" }\n];\n\nconst DEFAULT_PANEL_SETTINGS = {\n  pseudoCSS: DEFAULT_PSEUDO_CSS,\n  columnDefs: [],\n  isFullWidth: true,\n  allowOrdering: true,\n  allowSearching: true,\n  allowLengthChange: true,\n  pageLengths: '10,15,20,25,50,100',\n  initialPageLength: 25\n};\n\nexport class DataTablePanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n\n    this.$rootScope = $rootScope;\n\n    _.defaultsDeep(this.panel, DEFAULT_PANEL_SETTINGS);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n    this.events.on('panel-size-changed', this.onPanelSizeChanged.bind(this));\n  }\n\n  onPanelSizeChanged() {\n    this.fixDataTableSize();\n  }\n\n  onInitEditMode() {\n    let path = 'public/plugins/copperhill-datatables-panel/partials/';\n    this.addEditorTab('Options', `${path}editor.html`, 2);\n    this.addEditorTab('Column Definitions', `${path}column-defs.html`, 3);\n    this.addEditorTab('Styles', `${path}styles.html`, 4);\n  }\n\n  onInitPanelActions(actions) {\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCSV()' });\n  }\n\n  onDataError() {\n    this.draw();\n  }\n\n  onDataReceived(dataList) {\n    if (dataList && dataList.length) {\n      dataList.forEach(data => data.isReal = true);\n      this.dataList = dataList;\n    }\n    else {\n      let EXTRA_COLS = 2;\n      this.dataList = [\n        {\n          columns: [{ text: \"X\" }, { text: \"X * X\" }, { text: \"X + X\" }].concat(_.range(EXTRA_COLS).map(y => ({ text: `${y} / Math.random()` }))),\n          rows: _.range(150).map(x => [x, x * x, x + x].concat(_.range(EXTRA_COLS).map(y => y / Math.random()))),\n          isReal: false,\n          type: 'table'\n        }\n      ];\n    }\n\n    this.draw();\n  }\n\n  getConstByName(name) {\n    if (/^[A-Z_][A-Z_0-9]*$/.test(name)) {\n     return eval(name);\n    }\n  }\n\n  addColumnDef() {\n    this.panel.columnDefs.push({\n      filter: '/[^]*/',\n      display: '',\n      width: '',\n      classNames: '',\n      isVisible: true,\n      isOrderable: true,\n      isSearchable: true,\n      contentRules: []\n    });\n  }\n\n  removeColumnDef(columnDef) {\n    let columnDefs = this.panel.columnDefs;\n    columnDefs.splice(columnDefs.indexOf(columnDef), 1);\n  }\n\n  addColumnContentRule(columnDef) {\n    columnDef.contentRules.push({\n      type: CONTENT_RULE_TYPES[0].id,\n      classNames: '',\n      classLevel: CONTENT_RULE_CLASS_LEVELS[0].id,\n      filter: '',\n      negateCriteria: false,\n      display: '${value}',\n      displayIsHTML: false,\n      minValue: null,\n      maxValue: null,\n      minValueOp: null,\n      maxValueOp: null,\n      url: '',\n      openNewWindow: true\n    });\n  }\n\n  removeColumnContentRule(contentRule, columnDef) {\n    let contentRules = columnDef.contentRules;\n    contentRules.splice(contentRules.indexOf(contentRule), 1);\n  }\n\n  getPageLengthOptions() {\n    return this.panel.pageLengths\n        .replace(/\\s+/g, '')\n        .split(',')\n        .reduce(\n          (arr, x) => {\n            if (+x === parseInt(x, 10) && +x >= -1) {\n              x = x == -1 ? Infinity : +x;\n              arr.push({ value: x, text: x === Infinity ? 'All' : x });\n            }\n            return arr;\n          },\n          []\n        );\n  }\n\n  exportCSV() {\n    let div = JS.dom({ _: 'div' });\n    let data = this.parseDataList(0);\n\n    JS.dom({\n      _: 'a',\n      href: 'data:text/csv;charset=utf-8,' + encodeURIComponent(\n        toCSV(\n          data.rows.map(row => row.reduce((carry, cell) => {\n            if (cell.visible) {\n              div.innerHTML = cell.html;\n              carry.push(div.textContent);\n            }\n            return carry;\n          }, [])),\n          {\n            headers: data.columns.reduce((carry, header) => {\n              if (header.visible) {\n                div.innerHTML = header.html;\n                carry.push(div.textContent);\n              }\n              return carry;\n            }, [])\n          }\n        )\n      ),\n      download: this.panel.title + JS.formatDate(new Date, \" (YYYY-MM-DD 'at' H.mm.ss).'csv'\")\n    }).click();\n  }\n\n  getVarsByName() {\n    return this.templateSrv.variables.reduce(\n      (carry, variable) => {\n        // At times current.value is a string and at times it is an array.\n        let varValues = JS.toArray(variable.current.value);\n        let isAll = variable.includeAll && varValues.length === 1 && varValues[0] === '$__all';\n        carry[variable.name] = isAll ? [variable.current.text] : varValues;\n        return carry;\n      },\n      {}\n    );\n  }\n\n  setContent(data) {\n    let ctrl = this;\n    let panel = ctrl.panel;\n    let jElem = ctrl.panelElement;\n    let height = jElem.height();\n    let tableOpts = { _: 'table', cls: 'display', style: {} };\n    if (panel.isFullWidth) {\n      tableOpts.style.width = '100%';\n    }\n\n    let table = JS.dom(tableOpts);\n    let jTable = jQuery(table).appendTo(jElem.html(''));\n    let columns = data.columns;\n    let headers = data.headers;\n    let dataTableOpts = {\n      data: data.rows,\n      columns: columns.map((column, colIndex) => {\n        let result = { title: column.text };\n\n        let colDef = column.colDef;\n        if (colDef) {\n          if (result.visible = colDef.isVisible) {\n            if (colDef.width) {\n              result.width = colDef.width;\n            }\n            if (colDef.classNames) {\n              result.className = colDef.classNames;\n            }\n            result.orderable = colDef.isOrderable;\n            result.searchable = colDef.isSearchable;\n          }\n        }\n\n        return result;\n      }),\n      scrollY: height,\n      scrollX: true,\n      scrollCollapse: true,\n      ordering: panel.allowOrdering,\n      searching: panel.allowSearching,\n      lengthChange: panel.allowLengthChange,\n      lengthMenu: ctrl.getPageLengthOptions().reduce(\n        (arr, opt) => [\n          arr[0].concat([opt.value === Infinity ? -1 : opt.value]),\n          arr[1].concat([opt.value === Infinity ? 'All' : opt.value])\n        ],\n        [[], []]\n      ),\n      pageLength: panel.initialPageLength,\n      order: [],\n      rowCallback(tr, rowData) {\n        let tdIndex = 0;\n        rowData.forEach((cell, colIndex) => {\n          if (cell.visible) {\n            let jTD = jQuery('>td', tr).eq(tdIndex++);\n            if (cell.cls) {\n              if (cell.cls.level === 'ROW') {\n                jQuery(tr).addClass(cell.cls.names);\n              }\n              else {\n                jTD.addClass(cell.cls.names);\n              }\n            }\n            jTD.html(cell.html);\n          }\n        });\n      }\n    };\n    let dataTable = jTable.DataTable(dataTableOpts);\n\n    jElem.find('.dataTables_scrollHeadInner').css('margin', '0 auto');\n    ctrl.fixDataTableSize();\n\n    jElem.each((i, elem) => {\n      elem.className = elem.className.replace(/\\b_\\d+\\b/g, ' ').replace(/\\s+/g, ' ').trim();\n      elem.appendChild(JS.css(JSON.parse(pseudoCssToJSON(panel.pseudoCSS)), elem));\n    });\n  }\n\n  parseDataList() {\n    let ctrl = this;\n    let data = ctrl.dataList[0];\n    let columns = data.columns;\n    let rows = data.rows;\n    let varsByName = ctrl.getVarsByName();\n    let headers = columns.map(col => col.text);\n    let colDefs = ctrl.panel.columnDefs;\n    let colDefRgxs = colDefs.map(colDef => parseRegExp(colDef.filter));\n    let colDefContentRuleFilters = colDefs.map(\n      colDef => colDef.contentRules.map(\n        rule => rule.type === 'FILTER' ? parseRegExp(rule.filter) : null\n      )\n    );\n\n    columns = _.cloneDeep(columns).map(column => {\n      column = _.extend(\n        'string' === typeof column ? { text: column } : column,\n        { visible: true }\n      );\n\n      colDefRgxs.find((colDefRgx, colDefIndex) => {\n        if (colDefRgx.test(column.text)) {\n          let colDef = colDefs[colDefIndex];\n          if (colDef.display) {\n            column.text = column.text.replace(colDefRgx, colDef.display);\n          }\n          _.extend(column, {\n            colDef,\n            colDefContentRuleFilters: colDefContentRuleFilters[colDefIndex],\n            html: colDef.displayIsHTML ? column.text : _.escape(column.text),\n            visible: colDef.isVisible\n          });\n\n          return true;\n        }\n      });\n\n      if (!_.has(column, 'html')) {\n        column.html = _.escape(column.text);\n      }\n\n      return column;\n    });\n\n    rows = rows.map(row => {\n      return row.slice().map((cellValue, colIndex) => {\n        let column = columns[colIndex];\n        let colDef = column.colDef;\n\n        let cell = {\n          html: cellValue,\n          visible: column.visible\n        };\n\n        if (colDef) {\n          let rules = colDef.contentRules;\n          let cellsByColName = row.reduceRight(\n            (carry, val, i) => _.extend(carry, { [headers[i]]: val }),\n            {}\n          );\n\n          // Use Array#find() solely to match the first applicable rule...\n          rules.find((rule, ruleIndex) => {\n            let isMatch = true;\n            let type = rule.type;\n            let colDefContentRuleFilter = column.colDefContentRuleFilters[ruleIndex];\n            let gcvOptions = {\n              cell: cell.html,\n              cellsByColName,\n              rule,\n              colDefContentRuleFilter,\n              ctrl,\n              varsByName\n            };\n            if (type === 'FILTER') {\n              isMatch = colDefContentRuleFilter.test(cell.html);\n            }\n            else if (type === 'RANGE') {\n              let minValue = rule.minValue;\n              let minIsNum = RGX_SIMPLE_NUMBER.test(minValue);\n              let maxValue = rule.maxValue;\n              let maxIsNum = RGX_SIMPLE_NUMBER.test(maxValue);\n              if (minIsNum) {\n                minValue = +minValue;\n              }\n              if (maxIsNum) {\n                maxValue = +maxValue;\n              }\n\n              if (minIsNum || maxIsNum) {\n                cellValue = +cellValue;\n              }\n\n              let minValueOp = rule.minValueOp;\n              if (minValueOp) {\n                isMatch = isMatch && (minValueOp === '<=' ? minValue <= cellValue : (minValue < cellValue));\n              }\n              let maxValueOp = rule.maxValueOp;\n              if (maxValueOp) {\n                isMatch = isMatch && (maxValueOp === '>=' ? maxValue >= cellValue : (maxValue > cellValue));\n              }\n            }\n            else {\n              isMatch = cell.html == null;\n            }\n\n            isMatch = isMatch !== rule.negateCriteria;\n\n            // If this is a match apply the class(es)\n            if (isMatch) {\n              if (rule.classNames) {\n                cell.cls = {\n                  names: getCellValue(rule.classNames, false, gcvOptions),\n                  level: rule.classLevel\n                };\n              }\n\n              // Set the display\n              let displayHTML = getCellValue(rule.display, false, gcvOptions);\n              if (!rule.displayIsHTML) {\n                displayHTML = _.escape(displayHTML);\n              }\n              if (rule.url) {\n                let url = _.escape(getCellValue(rule.url, true, gcvOptions));\n                displayHTML = `<a href=\"${url}\" target=\"${rule.openNewWindow ? '_blank' : '_self'}\">${displayHTML}</a>`;\n              }\n              cell.html = displayHTML;\n            }\n\n            return isMatch;\n          });\n        }\n\n        return cell;\n      });\n    });\n\n    return { columns, rows, headers, type: data.type, refId: data.refId };\n  }\n\n  fixDataTableSize() {\n    let jElem = this.panelElement;\n    let fullHeight = jElem.height();\n    let jWrap = jElem.find('.dataTables_wrapper');\n    if (jWrap.length) {\n      let wrapHeight = jWrap.height();\n      let jScrollBody = jWrap.find('.dataTables_scrollBody');\n      let scrollHeight = jScrollBody.height();\n      let nonScrollHeight = wrapHeight - scrollHeight;\n      jScrollBody.css('max-height', fullHeight - nonScrollHeight);\n    }\n  }\n\n  draw() {\n    let error;\n    let isValid = false;\n    let ctrl = this;\n    let jElem = ctrl.element;\n    let jContent = ctrl.panelElement.css('position', 'relative').html('');\n    let elemContent = jContent[0];\n    let data = ctrl.parseDataList();\n\n    ctrl.pageLengthOptions = ctrl.getPageLengthOptions();\n\n    if (data && data.rows.length) {\n      if (data.type === 'table') {\n        try {\n          ctrl.setContent(data);\n          isValid = true;\n        }\n        catch (err) {\n          error = err;\n        }\n      }\n    }\n    if (!isValid) {\n      let msg = 'No data' + (error ? ':  \\r\\n' + error.message : '.');\n      let elemMsg = JS.dom({\n        _: 'div', style: { display: 'flex', alignItems: 'center', textAlign: 'center', height: '100%' }, $: [\n          { _: 'div', cls: 'alert alert-error', style: { margin: '0px auto' }, text: msg }\n        ]\n      });\n      jContent.html('').append(elemMsg);\n      if (error) {\n        throw error;\n      }\n    }\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.element = elem;\n    this.panelElement = elem.find('.panel-content');\n    this.throttleDraw = _.debounce(this.draw.bind(this), 1000);\n  }\n}\n\nDataTablePanelCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}